---
# tasks file for postgres
- name: POSTGRES | server
  apt:
    name:
      - postgresql
    state: present
- name: POSTGRES | Install dependancies
  apt:
    name:
      - python3-psycopg2
    state: present
- name: "Create a new database with name '{{ db_name }}' and specific encoding and locale # settings"
  community.postgresql.postgresql_db:
    name: '{{ db_name }}'
    encoding: UTF-8
    state: present
  become: yes
  become_user: postgres
- name: "Connect to {{ db_name }} database, create {{ db_user }} user"
  community.postgresql.postgresql_user:
    db: "{{ db_name }}"
    name: "{{ db_user }}"
    password: "{{ db_password }}"
  become: yes
  become_user: postgres
- name: "GRANT ALL PRIVILEGES ON SCHEMA public TO {{ db_user }}"
  community.postgresql.postgresql_privs:
    type: database
    database: "{{ db_name }}"
    roles: "{{ db_user }}"
    grant_option: no
    privs: ALL
  become: yes
  become_user: postgres
